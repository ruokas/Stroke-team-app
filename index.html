<!doctype html>
<html lang="lt" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stroke Team – Greito įvedimo aplikacija</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header>
      <div class="wrap">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>Stroke Team · Greito įvedimo aplikacija</h1>
            <div class="subtle">
              Skubi duomenų registracija, laikų sekimas, vaistų skaičiuoklės ir
              santrauka HIS sistemai
            </div>
          </div>
        </div>
        <div class="header-actions">
          <button id="newPatientBtn" title="Naujas pacientas" class="btn">
            🆕 <span class="btn-label">Naujas</span>
          </button>
          <button
            id="saveBtn"
            title="Išsaugoti vietoje (naršyklėje)"
            class="btn"
          >
            💾 <span class="btn-label">Išsaugoti</span>
          </button>
          <details class="more-actions">
            <summary>⋮</summary>
            <div class="menu">
              <select
                id="draftSelect"
                title="Išsaugoti juodraščiai"
                class="btn"
              ></select>
              <button id="loadBtn" title="Atkurti pasirinktą" class="btn">
                📂 <span class="btn-label">Atkurti</span>
              </button>
              <button
                id="renameDraftBtn"
                title="Pervardyti juodraštį"
                class="btn"
              >
                ✏️ <span class="btn-label">Pervardyti</span>
              </button>
              <button
                id="deleteDraftBtn"
                title="Ištrinti juodraštį"
                class="btn"
              >
                🗑️ <span class="btn-label">Trinti</span>
              </button>
              <button id="exportBtn" title="Eksportuoti JSON" class="btn">
                ⬇️ <span class="btn-label">Eksportuoti</span>
              </button>
              <input
                id="importFile"
                type="file"
                accept="application/json"
                class="hidden"
              />
              <button id="importBtn" title="Importuoti JSON" class="btn">
                ⬆️ <span class="btn-label">Importuoti</span>
              </button>
            </div>
          </details>
        </div>
      </div>
      <div id="saveStatus" aria-live="polite"></div>
    </header>

    <div class="wrap layout-main">
      <button id="navToggle" class="btn">☰ Meniu</button>
      <nav>
        <a href="#" data-section="activation" class="tab active"
          ><span class="tab-icon">🚨</span>Aktyvacija</a
        >
        <a href="#" data-section="arrival" class="tab"
          ><span class="tab-icon">🚑</span>Paciento atvykimas</a
        >
        <a href="#" data-section="patient" class="tab"
          ><span class="tab-icon">🧍</span>Paciento informacija</a
        >
        <a href="#" data-section="times" class="tab"
          ><span class="tab-icon">⏱️</span>Laikai ir tikslai</a
        >
        <a href="#" data-section="drugs" class="tab"
          ><span class="tab-icon">💊</span>Vaistų skaičiuoklės</a
        >
        <a href="#" data-section="interventions" class="tab"
          ><span class="tab-icon">🛠️</span>Tyrimai ir intervencijos</a
        >
        <a href="#" data-section="summarySec" class="tab"
          ><span class="tab-icon">📄</span>Santrauka</a
        >
      </nav>
      <main class="px-0">
        <!-- Aktyvacija -->
        <section id="activation" class="card">
          <h2>Komandos aktyvacija</h2>
          <form>
            <fieldset>
              <legend>Paciento duomenys</legend>
              <div class="grid-2">
                <div>
                  <label for="a_personal">Asmens kodas</label>
                  <input id="a_personal" type="text" />
                </div>
                <div>
                  <label for="a_name">Vardas, Pavardė</label>
                  <input id="a_name" type="text" />
                </div>
                <div>
                  <label for="a_dob">Gimimo data</label>
                  <input id="a_dob" type="date" />
                  <div id="a_age_display" class="subtle"></div>
                  <input id="a_age" type="hidden" />
                </div>
              </div>
            </fieldset>

            <fieldset>
              <legend>Simptomai</legend>
              <table class="tbl">
                <thead>
                  <tr>
                    <th>Sutrikimas</th>
                    <th>Taip</th>
                    <th>Ne</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Veido paralyžius</td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_face" value="yes" />Taip</label
                      >
                    </td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_face" value="no" />Ne</label
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>Rankos silpnumas</td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_arm" value="yes" />Taip</label
                      >
                    </td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_arm" value="no" />Ne</label
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>Kalbos sutrikimas</td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_speech" value="yes" />Taip</label
                      >
                    </td>
                    <td>
                      <label class="pill"
                        ><input type="radio" name="a_speech" value="no" />Ne</label
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>Pusiausvyros sutrikimas</td>
                    <td>
                      <label class="pill"
                        ><input
                          type="radio"
                          name="a_balance"
                          value="yes"
                        />Taip</label
                      >
                    </td>
                    <td>
                      <label class="pill"
                        ><input
                          type="radio"
                          name="a_balance"
                          value="no"
                        />Ne</label
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>Sąmonės/kvėpavimo sutrikimas</td>
                    <td>
                      <label class="pill"
                        ><input
                          type="radio"
                          name="a_conscious"
                          value="yes"
                        />Taip</label
                      >
                    </td>
                    <td>
                      <label class="pill"
                        ><input
                          type="radio"
                          name="a_conscious"
                          value="no"
                        />Ne</label
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
            </fieldset>

            <fieldset>
              <legend>Vartojami vaistai</legend>
              <div class="grid-2">
                <label class="pill"
                  ><input id="a_warfarin" type="checkbox" />Varfarinas</label
                >
                <label class="pill"
                  ><input id="a_apixaban" type="checkbox" />Apiksabanas</label
                >
                <label class="pill"
                  ><input id="a_rivaroxaban" type="checkbox" />Rivaroksabanas</label
                >
                <label class="pill"
                  ><input id="a_dabigatran" type="checkbox" />Dabigatranas</label
                >
                <label class="pill"
                  ><input id="a_edoxaban" type="checkbox" />Edoksabanas</label
                >
                <label class="pill"
                  ><input id="a_unknown" type="checkbox" />Nežinoma</label
                >
              </div>
            </fieldset>

            <fieldset>
              <legend>Paskutinį kartą matytas sveikas</legend>
              <div class="grid-3">
                <label class="pill"
                  ><input type="radio" name="a_lkw" value="<4.5" /> &lt;4,5 val
                  (aktyvuoti insulto komandą)</label
                >
                <label class="pill"
                  ><input type="radio" name="a_lkw" value="4.5-24" /> &gt;4,5 val
                  bet &lt;24 val (informuoti SPS gyd.)</label
                >
                <label class="pill"
                  ><input type="radio" name="a_lkw" value="unknown" /> Nežinoma</label
                >
              </div>
            </fieldset>

            <fieldset>
              <legend>Parametrai</legend>
              <div class="grid-2">
                <div>
                  <label for="a_glucose">Gliukozė</label>
                  <input id="a_glucose" type="text" />
                </div>
                <div>
                  <label for="a_aks">AKS</label>
                  <input id="a_aks" type="text" />
                </div>
                <div>
                  <label for="a_hr">ŠSD</label>
                  <input id="a_hr" type="text" />
                </div>
                <div>
                  <label for="a_spo2">SpO₂</label>
                  <input id="a_spo2" type="text" />
                </div>
                <div>
                  <label for="a_temp">Temperatūra</label>
                  <input id="a_temp" type="text" />
                </div>
              </div>
            </fieldset>
          </form>
        </section>

        <!-- Paciento atvykimas -->
        <section id="arrival" class="card hidden">
          <h2>Paciento atvykimas</h2>
          <form>
            <fieldset>
              <legend>Atvykimo laikas</legend>
              <div class="row">
                <input id="t_door" type="datetime-local" />
                <button class="btn ghost" data-now="t_door">Dabar</button>
              </div>
            </fieldset>

            <fieldset>
              <legend>Paskutinį kartą matytas sveikas</legend>
              <div class="grid-3">
                <label class="pill"
                  ><input type="radio" name="lkw_type" value="known" checked />
                  Paskutinį kartą matytas sveikas</label
                >
                <label class="pill"
                  ><input type="radio" name="lkw_type" value="unknown" />
                  Nežinoma</label
                >
                <label class="pill"
                  ><input type="radio" name="lkw_type" value="sleep" /> Miego
                  vidurio laikas</label
                >
              </div>
              <div id="lkwTimeRow" class="row mt-4">
                <input id="t_lkw" type="datetime-local" />
                <button class="btn ghost" data-now="t_lkw">Dabar</button>
              </div>
            </fieldset>

            <fieldset>
              <legend>Simptomai</legend>
              <textarea id="arrival_symptoms" rows="3"></textarea>
            </fieldset>

            <fieldset>
              <legend>Kontraindikacijos trombolizei</legend>
              <textarea id="arrival_contra" rows="3"></textarea>
            </fieldset>
          </form>
        </section>

        <!-- Paciento informacija -->
        <section id="patient" class="card hidden">
          <h2>Paciento informacija</h2>
          <form>
            <fieldset class="grid-2">
              <div>
                <label for="p_id">Ligos istorijos Nr.</label>
                <input id="p_id" type="text" placeholder="(nebūtina)" />
              </div>
              <div>
                <label for="p_sex">Lytis</label>
                <select id="p_sex">
                  <option value="">—</option>
                  <option value="Vyras">Vyras</option>
                  <option value="Moteris">Moteris</option>
                  <option value="Kita / nenurodyta">Kita / nenurodyta</option>
                </select>
              </div>
              <div>
                <label for="p_weight">Svoris (kg)</label>
                <input
                  id="p_weight"
                  type="number"
                  min="1"
                  max="300"
                  step="0.1"
                  placeholder="kg"
                />
              </div>
              <div>
                <label for="p_bp">AKS atvykus (mmHg)</label>
                <input id="p_bp" type="text" placeholder="pvz. 178/92" />
              </div>
              <div>
                <label for="p_nihss0">NIHSS (pradinis)</label>
                <input id="p_nihss0" type="number" min="0" max="42" />
                <details class="nihss-calc" data-target="p_nihss0">
                  <summary><span class="pill">🧮 Skaičiuoti</span></summary>
                  <div class="card">
                    <div class="nihss-grid">
                      <label>1a. Sąmonės lygis<input type="number" min="0" max="3" data-score /></label>
                      <label>1b. Klausimai<input type="number" min="0" max="2" data-score /></label>
                      <label>1c. Komandos<input type="number" min="0" max="2" data-score /></label>
                      <label>2. Žvilgsnis<input type="number" min="0" max="2" data-score /></label>
                      <label>3. Regėjimas<input type="number" min="0" max="3" data-score /></label>
                      <label>4. Veido judesiai<input type="number" min="0" max="3" data-score /></label>
                      <label>5a. Rankos (K)<input type="number" min="0" max="4" data-score /></label>
                      <label>5b. Rankos (D)<input type="number" min="0" max="4" data-score /></label>
                      <label>6a. Kojos (K)<input type="number" min="0" max="4" data-score /></label>
                      <label>6b. Kojos (D)<input type="number" min="0" max="4" data-score /></label>
                      <label>7. Ataksija<input type="number" min="0" max="2" data-score /></label>
                      <label>8. Jutimai<input type="number" min="0" max="2" data-score /></label>
                      <label>9. Kalba<input type="number" min="0" max="3" data-score /></label>
                      <label>10. Artikuliacija<input type="number" min="0" max="2" data-score /></label>
                      <label>11. Neglect<input type="number" min="0" max="2" data-score /></label>
                    </div>
                    <div class="nihss-actions">
                      <strong>Viso: <span class="nihss-total">0</span></strong>
                      <button type="button" class="btn apply">Taikyti</button>
                    </div>
                  </div>
                </details>
              </div>
              <div>
                <label for="p_nihss24">NIHSS (24 h)</label>
                <input id="p_nihss24" type="number" min="0" max="42" />
                <details class="nihss-calc" data-target="p_nihss24">
                  <summary><span class="pill">🧮 Skaičiuoti</span></summary>
                  <div class="card">
                    <div class="nihss-grid">
                      <label>1a. Sąmonės lygis<input type="number" min="0" max="3" data-score /></label>
                      <label>1b. Klausimai<input type="number" min="0" max="2" data-score /></label>
                      <label>1c. Komandos<input type="number" min="0" max="2" data-score /></label>
                      <label>2. Žvilgsnis<input type="number" min="0" max="2" data-score /></label>
                      <label>3. Regėjimas<input type="number" min="0" max="3" data-score /></label>
                      <label>4. Veido judesiai<input type="number" min="0" max="3" data-score /></label>
                      <label>5a. Rankos (K)<input type="number" min="0" max="4" data-score /></label>
                      <label>5b. Rankos (D)<input type="number" min="0" max="4" data-score /></label>
                      <label>6a. Kojos (K)<input type="number" min="0" max="4" data-score /></label>
                      <label>6b. Kojos (D)<input type="number" min="0" max="4" data-score /></label>
                      <label>7. Ataksija<input type="number" min="0" max="2" data-score /></label>
                      <label>8. Jutimai<input type="number" min="0" max="2" data-score /></label>
                      <label>9. Kalba<input type="number" min="0" max="3" data-score /></label>
                      <label>10. Artikuliacija<input type="number" min="0" max="2" data-score /></label>
                      <label>11. Neglect<input type="number" min="0" max="2" data-score /></label>
                    </div>
                    <div class="nihss-actions">
                      <strong>Viso: <span class="nihss-total">0</span></strong>
                      <button type="button" class="btn apply">Taikyti</button>
                    </div>
                  </div>
                </details>
              </div>
            </fieldset>
          </form>
        </section>

        <!-- Laikai -->
        <section id="times" class="card hidden">
          <h2>Laikai ir tikslai</h2>
          <form>
            <fieldset class="grid-2">
              <div>
                <label for="t_onset">Simptomų pradžia</label>
                <div class="row">
                  <input id="t_onset" type="datetime-local" />
                  <button class="btn ghost" data-now="t_onset">Dabar</button>
                </div>
              </div>
              <div>
                <label for="t_ct">KT pradžia</label>
                <div class="row">
                  <input id="t_ct" type="datetime-local" />
                  <button class="btn ghost" data-now="t_ct">Dabar</button>
                </div>
              </div>
              <div>
                <label for="t_needle">Trombolizės pradžia</label>
                <div class="row">
                  <input id="t_needle" type="datetime-local" />
                  <button class="btn ghost" data-now="t_needle">Dabar</button>
                </div>
              </div>
              <div>
                <label for="t_groin">Kateterizacijos pradžia</label>
                <div class="row">
                  <input id="t_groin" type="datetime-local" />
                  <button class="btn ghost" data-now="t_groin">Dabar</button>
                </div>
              </div>
              <div>
                <label for="t_reperf">Reperfuzijos laikas</label>
                <div class="row">
                  <input id="t_reperf" type="datetime-local" />
                  <button class="btn ghost" data-now="t_reperf">Dabar</button>
                </div>
              </div>
            </fieldset>
          </form>
          <div class="h-10"></div>
          <div class="grid-3" id="kpiRow">
            <div class="kpi" id="kpi_d2ct">
              <div class="dot"></div>
              <div>
                <div class="muted">Atvykimas → KT</div>
                <div class="val" data-val>D2CT: —</div>
              </div>
            </div>
            <div class="kpi" id="kpi_d2n">
              <div class="dot"></div>
              <div>
                <div class="muted">Atvykimas → Trombolizė</div>
                <div class="val" data-val>D2N: —</div>
              </div>
            </div>
            <div class="kpi" id="kpi_d2g">
              <div class="dot"></div>
              <div>
                <div class="muted">Atvykimas → Kateterizacija</div>
                <div class="val" data-val>D2G: —</div>
              </div>
            </div>
          </div>
          <div class="mini mt-8">
            Tikslai (keičiasi nustatymuose): D2CT ≤
            <span id="g_ct_goal">20</span> min · D2N ≤
            <span id="g_n_goal">60</span> min · D2G ≤
            <span id="g_g_goal">90</span> min
          </div>
        </section>

        <!-- Vaistų skaičiuoklės -->
        <section id="drugs" class="card hidden">
          <h2>Vaistų skaičiuoklės</h2>
          <div class="grid-2">
            <div>
              <label>Vaistas</label>
              <select id="drug_type">
                <option value="tnk">
                  Tenekteplazė (TNK) – 0,25 mg/kg (max 25 mg), bolius
                </option>
                <option value="tpa">
                  Alteplazė (tPA) – 0,9 mg/kg (max 90 mg), 10% bolius + 90% per
                  60 min
                </option>
              </select>
            </div>
            <div>
              <label>Koncentracija (mg/ml)</label>
              <input
                id="drug_conc"
                type="number"
                step="0.01"
                placeholder="pvz. 5"
              />
            </div>
          </div>
          <div class="grid-3 mt-10">
            <div>
              <label>Svoris (kg)</label>
              <input
                id="calc_weight"
                type="number"
                min="1"
                max="300"
                step="0.1"
                placeholder="kg"
              />
            </div>
            <div>
              <label>Bendra dozė (mg)</label>
              <input id="dose_total" type="number" step="0.1" readonly />
            </div>
            <div>
              <label>Tūris (ml)</label>
              <input id="dose_volume" type="number" step="0.1" readonly />
            </div>
          </div>
          <div id="tpaBreakdown" class="grid-2 mt-10 hidden">
            <div>
              <label>Bolius 10% (mg / ml)</label>
              <input id="tpa_bolus" type="text" readonly />
            </div>
            <div>
              <label>Infuzija 90% per 60 min (mg / ml / ml/val)</label>
              <input id="tpa_infusion" type="text" readonly />
            </div>
          </div>
          <div class="section-actions mt-10">
            <button id="calcBtn" class="btn primary">🧮 Skaičiuoti</button>
            <span class="mini"
              >Pastaba: klinikiniai sprendimai remiasi vietinėmis gairėmis. Ši
              skaičiuoklė – pagalbinė.</span
            >
          </div>
        </section>

        <!-- Intervencijos ir tyrimai -->
        <section id="interventions" class="card hidden">
          <h2>Tyrimai ir intervencijos</h2>
          <div class="grid-2">
            <div>
              <label
                ><input id="i_ct" type="checkbox" /> KT galvos atlikta</label
              >
              <label
                ><input id="i_cta" type="checkbox" /> CTA/CTP atlikta</label
              >
              <label
                ><input id="i_thrombolysis" type="checkbox" /> IV trombolizė
                atlikta</label
              >
              <label
                ><input id="i_thrombectomy" type="checkbox" /> Mechaninė
                trombektomija atlikta</label
              >
            </div>
            <div>
              <label>TICI (po MT)</label>
              <select id="i_tici">
                <option value="">—</option>
                <option>TICI 0</option>
                <option>TICI 1</option>
                <option>TICI 2a</option>
                <option>TICI 2b</option>
                <option>TICI 2c</option>
                <option>TICI 3</option>
              </select>
              <label class="mt-10">Sprendimas</label>
              <select id="i_decision">
                <option value="">—</option>
                <option>Hospitalizuotas (insulto skyrius)</option>
                <option>Perkeltas į intervencinę radiologiją</option>
                <option>Išleistas namo</option>
                <option>Pervežtas į aukštesnio lygio ASPĮ</option>
              </select>
            </div>
          </div>
          <div>
            <label>Pastabos</label>
            <textarea
              id="notes"
              rows="4"
              placeholder="Kiti svarbūs faktai (AKS valdymas, antikoaguliantai, gliukozė, kontraindikacijos ir kt.)"
            ></textarea>
          </div>
        </section>

        <!-- Santrauka HIS sistemai -->
        <section id="summarySec" class="card full-span hidden">
          <h2>Santrauka (kopijavimui į HIS)</h2>
          <textarea
            id="summary"
            class="summary mono"
            placeholder="Santrauka generuojama automatiškai"
          ></textarea>
          <div class="sticky-actions">
            <button id="copySummaryBtn" class="btn">📋 Kopijuoti</button>
          </div>
        </section>

        <details class="settings">
          <summary><span class="pill">⚙️ Nustatymai</span></summary>
          <div class="card">
            <div class="grid-3">
              <div>
                <label>D2CT tikslas (min)</label>
                <input
                  id="goal_ct"
                  type="number"
                  min="1"
                  max="180"
                  value="20"
                />
              </div>
              <div>
                <label>D2N tikslas (min)</label>
                <input id="goal_n" type="number" min="1" max="240" value="60" />
              </div>
              <div>
                <label>D2G tikslas (min)</label>
                <input id="goal_g" type="number" min="1" max="240" value="90" />
              </div>
            </div>
            <div class="grid-3 mt-10">
              <div>
                <label>TNK numatyta koncentracija (mg/ml)</label>
                <input id="def_tnk" type="number" step="0.1" value="5" />
              </div>
              <div>
                <label>tPA numatyta koncentracija (mg/ml)</label>
                <input id="def_tpa" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Automatinis išsaugojimas</label>
                <select id="autosave">
                  <option value="on">Įjungtas</option>
                  <option value="off">Išjungtas</option>
                </select>
              </div>
            </div>
          </div>
        </details>

        <div class="footer">
          ⚠️ Atskaita: ši priemonė yra pagalbinė. Galutiniai klinikiniai
          sprendimai remiasi gydytojo vertinimu ir galiojančiomis gairėmis.
        </div>
      </main>

      <!-- Šoninis informacinis stulpelis -->
      <aside class="container px-0">
        <section class="card">
          <h2>Gyvas laikmatis</h2>
          <div id="liveTimers" class="grid-3">
            <div class="kpi" title="Nuo atvykimo">
              <div class="dot" id="t_since_door_dot"></div>
              <div>
                <div class="muted">Praėjo nuo atvykimo</div>
                <div class="val" id="t_since_door">—</div>
              </div>
            </div>
            <div class="kpi" title="Nuo pradžios">
              <div class="dot" id="t_since_onset_dot"></div>
              <div>
                <div class="muted">Praėjo nuo pradžios</div>
                <div class="val" id="t_since_onset">—</div>
              </div>
            </div>
            <div
              class="kpi"
              title="Lango likutis iki D2N tikslo (jei nepradėta)"
            >
              <div class="dot" id="t_to_needle_dot"></div>
              <div>
                <div class="muted">Iki trombolizės tikslo</div>
                <div class="val" id="t_to_needle">—</div>
              </div>
            </div>
          </div>
          <div class="mini mt-8">Laikmačiai atsinaujina kas 1 s</div>
        </section>

        <section class="card">
          <h2>Greiti veiksmai</h2>
          <div class="section-actions">
            <button data-now="t_ct" class="btn">📸 Pažymėti KT dabar</button>
            <button data-now="t_needle" class="btn">
              💉 Pažymėti trombolizę dabar
            </button>
            <button data-now="t_groin" class="btn">
              🕳️ Pažymėti kateterizaciją dabar
            </button>
            <button id="clearTimes" class="btn">🧹 Išvalyti laikus</button>
          </div>
        </section>

        <section class="card">
          <h2>Naudojimo patarimai</h2>
          <ol class="mini m0 ml-18">
            <li>
              Užpildykite bent „Atvykimo“ ir „Pradžios/LKW“ laikus – rodikliai
              paskaičiuos automatškai.
            </li>
            <li>
              Įveskite svorį ir pasirinkite vaistą – skaičiuoklė pateiks tikslią
              dozę ir tūrius.
            </li>
            <li>
              Pažymėkite atliktas intervencijas, atverkite santrauką – ji
              generuojama automatiškai – ir spauskite „Kopijuoti“.
            </li>
            <li>
              „Išsaugoti/Atkurti“ naudoja vietinę naršyklės atmintį
              (localStorage).
            </li>
          </ol>
        </section>
      </aside>
    </div>

    <script type="module" src="js/app.js"></script>
  </body>
</html>
